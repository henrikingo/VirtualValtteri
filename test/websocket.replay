#!/usr/bin/env python

import asyncio
import websockets
import os
import time

wsdump = open("vmkarting.wsdump", "r").readlines()

async def replay(websocket, path):
        print("Websocket connecting...")
        for line in wsdump:
            #print(str(len(line)) + " " + str([ord(a) for a in line]))
            await websocket.send(line)
            if len(line) < 3:
                time.sleep(0.3)

start_server = websockets.serve(replay, "0.0.0.0", os.environ.get('PORT') or 8080)

print("WebSockets replay server starting", flush=True)
asyncio.get_event_loop().run_until_complete(start_server)
asyncio.get_event_loop().run_forever()
